<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="paper-full.js"></script>
<script type="text/javascript">
    paper.install(window);
    
    var RectFillColor = 'yellow';
    var RectStrokeColor = 'blue';
    var TextFillColor = 'black';

    var RectFillColorOnFocus = 'blue';
    var RectStrokeColorOnFocus = 'yellow';
    var TextFillColorOnFocus = 'black';

    var CenterTileFillColor = 'orange';
    var CenterTileStrokeColor = 'blue';

    var WireStrokeColor = 'green';

	window.onload = function() {
		paper.setup('myCanvas');

		// Create two drawing tools.
		// tool1 will draw straight lines,
		// tool2 will draw clouds.

		// Both share the mouseDown event:
		var path;
			path = new Path();

            // Use the arcTo command to draw cloudy lines
            //var rect = new Path.Rectangle(event.point,)
            var circle = new Path.Circle(new paper.Point(80, 50), 35);
            var group = new Group();

            var tile1 = addTile(100,30, 'kanagaraj');
            var tile2 = addTile(140,70, 'subham');
            var tile3 = addTile(40,110, 'iswarya');
            var tile5 = addTile(100,30, 'kanagaraj');
            var tile6 = addTile(140,70, 'subham');
            var tile7 = addTile(40,110, 'iswarya');
            
            var tile15 = addTile(100,30, 'kanagaraj');
            var tile16 = addTile(140,70, 'subham');
            var tile17 = addTile(40,110, 'iswarya');
            
            var tile25 = addTile(100,30, 'kanagaraj');
            var tile26 = addTile(140,70, 'subham');
            var tile27 = addTile(40,110, 'iswarya');
            
            var tile4 = addTile(180,150, 'three musketeers');

            var groupedTiles = connectTiles(tile4,tile1,tile2, tile3,tile5,tile6,tile7,tile15,tile16,tile17,tile25,tile26,tile27);
            //groupedTiles.smooth();
            console.log(tile1);
           // group.scale(1.5);
           path.onFrame = function(event) {
           // Every frame, rotate the path by 3 degrees:
            //text.rotate(3);
            //circle.moveBy(10,10);
           }

        
			//path.arcTo(event.point);
    }
    
    addTile = function(x,y, title) {
            var text = new PointText(new Point(x, y));
            text.fillColor = TextFillColor;
            text.content = title;
            var rect =  new Path.Rectangle(text.bounds,6);
            rect.scale(1.2,1.5);
            rect.strokeColor = RectStrokeColor;
            rect.strokeWidth = 2;
            rect.fillColor = RectFillColor;
            rect.blendMode = 'multiply';
            var group = new Group();
            group.addChild(text);
            group.addChild(rect);
            group.scale(1.5);
            group.position = new paper.Point(x,y);
            group.onMouseEnter = function(event) {
                rect.fillColor = RectFillColorOnFocus;
                text.fillColor = TextFillColorOnFocus;
                event.stopPropagation();
                return false;
            }
            group.onMouseLeave = function(event) {
                rect.fillColor = RectFillColor;
                rect.strokeColor = RectStrokeColor;
                text.fillColor = TextFillColor;
                event.stopPropagation();
                return false;
            }
            return group;
          }

    connectTiles = function(centerTile,...args) {
        if(args.length > 0 && centerTile != null)
        {
            centerTile.position = view.center;
            var group = new Group();
            centerTile.scale(1.5);
            centerTile.fillColor = CenterTileFillColor;
            centerTile.strokeColor = CenterTileStrokeColor;
            group.addChild(centerTile);
            var parentCenter = centerTile.bounds.center;
            positionChildren(centerTile, args);
        for(var i=0;i<args.length;i++)
        {
           var childCenter = args[i].bounds.center;
           var wire = addConnectingWire(parentCenter, childCenter);
           group.addChild(wire);
           group.addChild(args[i]);
        }
            return group;
        }
    }

    positionChildren = function(centerTile,args){
        var minDistX = 0;
        var minDistY = 0;
        var centerBound = centerTile.bounds;
        var topCenterPoint = new paper.Point(centerBound.centerX,centerBound.top);
        var bottomCenterPoint = new paper.Point(centerBound.centerX,centerBound.bottom);
        var placedTiles = new Array();
        var lastTopRight = topCenterPoint;
        var lastBottomRight = bottomCenterPoint;
        var lastBottomLeft = bottomCenterPoint;
        var lastTopLeft = topCenterPoint;
        for(var i=0;i<args.length;i++)
        {
            var tile = args[i];
            var side = i % 4;
            switch(side)
            {
                case 0: // top right
                    lastTopRight = positionTopRight(minDistX,minDistY, lastTopRight, args[i], placedTiles);
                    break;
                case 1: // bottom right
                    lastBottomRight = positionBottomRight(minDistX,minDistY, lastBottomRight, args[i], placedTiles);
                    break;
                case 2: // bottom left
                    lastBottomLeft = positionBottomLeft(minDistX,minDistY, lastBottomLeft, args[i], placedTiles);
                    break;
                case 3: // top left
                    lastTopLeft = positionTopLeft(minDistX,minDistY, lastTopLeft, args[i], placedTiles);
                    minDistX = 10;
                    minDistY = 10;
                    break;
            }
            placedTiles.push(tile);
        }
    }

    positionTopRight = function(minDistX, minDistY, centerPoint, tile, args) {
        var pos = new paper.Point(centerPoint);
        var temp = getRandomPosition(minDistX, minDistY);
        pos.x = pos.x + temp.x;
        pos.y = pos.y - 50; 
        tile.position = pos;
        return pos;
    }

    positionBottomRight = function(minDistX, minDistY, centerPoint, tile, args) {
        var pos = new paper.Point(centerPoint);
        var temp = getRandomPosition(minDistX, minDistY);
        pos.x = pos.x + temp.x;
        pos.y = pos.y + 50; 
        tile.position = pos;
        return pos;
    }

    positionBottomLeft = function(minDistX, minDistY, centerPoint, tile, args) {
        var pos = new paper.Point(centerPoint);
        var temp = getRandomPosition(minDistX, minDistY);
        pos.x = pos.x - temp.x;
        pos.y = pos.y + 50; 
        tile.position = pos;
        return pos;
    }

    positionTopLeft = function(minDistX, minDistY, centerPoint, tile, args) {
        var pos = new paper.Point(centerPoint);
        var temp = getRandomPosition(minDistX, minDistY);
        pos.x = pos.x - temp.x;
        pos.y = pos.y - 50; 
        tile.position = pos;
        return pos;
    }

    getRandomPosition = function(minDistX, minDistY) {
        var temp = new paper.Point(minDistX, minDistY)
        var rand = paper.Point.random();
        rand.x = rand.x * 100;
        rand.y = rand.y * 100;
        temp.x = temp.x + rand.x;
        temp.y = temp.y + rand.y;
        return temp;
    }

    addConnectingWire = function(point1,point2){
        var group = new Group();
        var path = new Path(point1);
           path.strokeColor = WireStrokeColor;
           path.strokeWidth = 2;
           path.blendMode = 'difference';
           path.add(point2);
        group.addChild(path);      
     }
</script>
</head>
<body>
    <canvas id="myCanvas" width="1000" height="500" style="border:2;border: 1px solid black;"></canvas>
</body>
</html>